using GameNetcodeStuff;
using MoreShipUpgrades.Misc;
using MoreShipUpgrades.UpgradeComponents;
using Newtonsoft.Json;
using System.Collections.Generic;
using System.IO;
using System.Linq;
using System.Reflection;
using Unity.Netcode;
using UnityEngine;

namespace MoreShipUpgrades.Managers
{
    public class UpgradeBus : NetworkBehaviour
    {
        public static UpgradeBus instance;
        public PluginConfig cfg;
        public GameObject introScreen;

        public bool DestroyTraps = false;
        public bool softSteps = false;
        public bool scannerUpgrade = false;
        public bool nightVision = false;
        public bool nightVisionActive = false;
        public float nightVisRange;
        public float nightVisIntensity;
        public bool exoskeleton = false;
        public bool TPButtonPressed = false;
        public bool beekeeper = false;
        public bool terminalFlash = false;
        public bool strongLegs = false;
        public bool runningShoes = false;
        public bool lockSmith = false;
        public bool biggerLungs = false;
        public bool proteinPowder = false;

        public int lungLevel = 0;
        public int proteinLevel = 0;
        public int beeLevel = 0;
        public int backLevel = 0;
        public int runningLevel = 0;
        public int lightLevel = 0;
        public int discoLevel = 0;
        public int legLevel = 0;
        public int nightVisionLevel = 0;

        public float flashCooldown = 0f;
        public float alteredWeight = 1f;

        public trapDestroyerScript trapHandler = null;
        public terminalFlashScript flashScript = null;
        public lockSmithScript lockScript = null;
        public defibScript internScript = null;
        public walkieScript walkieHandler = null;

        public Color nightVisColor;
        public AudioClip flashNoise;
        public GameObject modStorePrefab;
        public TerminalNode modStoreInterface;

        public List<CustomTerminalNode> terminalNodes = new List<CustomTerminalNode>();

        public Dictionary<string, GameObject> UpgradeObjects = new Dictionary<string, GameObject>();

        public Dictionary<ulong,float> beePercs = new Dictionary<ulong,float>();
        public Dictionary<ulong,int> forceMults = new Dictionary<ulong,int>();

        public Dictionary<string,bool> IndividualUpgrades = new Dictionary<string,bool>();
        public string[] internNames, internInterests;

        public List<coilHeadItem> coilHeadItems = new List<coilHeadItem>();
        internal bool walkies;
        internal bool walkieUIActive;
        internal string version;

        public AssetBundle UpgradeAssets;

        void Awake()
        {
            instance = this;
            DontDestroyOnLoad(gameObject);
            cfg = Plugin.cfg;
        }

        public TerminalNode ConstructNode()
        {
            modStoreInterface = new TerminalNode();
            modStoreInterface.clearPreviousText = true;
            foreach (CustomTerminalNode terminalNode in terminalNodes)
            {
                string saleStatus = terminalNode.salePerc < 1f ? $"- {((1-terminalNode.salePerc)*100).ToString("F0")}% OFF!" : "";
                if (!terminalNode.Unlocked) { modStoreInterface.displayText += $"\n{terminalNode.Name} // ${(int)(terminalNode.UnlockPrice * terminalNode.salePerc)} {saleStatus}  "; }
                else if (terminalNode.MaxUpgrade == 0) { modStoreInterface.displayText += $"\n{terminalNode.Name} // UNLOCKED  "; }
                else if (terminalNode.MaxUpgrade > terminalNode.CurrentUpgrade) { modStoreInterface.displayText += $"\n{terminalNode.Name} // ${(int)(terminalNode.Prices[terminalNode.CurrentUpgrade]*terminalNode.salePerc)} // LVL {terminalNode.CurrentUpgrade + 1} {saleStatus}  "; }
                else { modStoreInterface.displayText += $"\n{terminalNode.Name} // MAX LVL"; }
            }
            if (modStoreInterface.displayText == "")
            {
                modStoreInterface.displayText = "No upgrades available";
            }
            modStoreInterface.displayText += "\n\n";
            return modStoreInterface;
        }

        public void ResetAllValues(bool wipeObjRefs = true)
        {
            DestroyTraps = false;
            softSteps = false;
            scannerUpgrade = false;
            nightVision = false;
            walkies = false;
            nightVisionActive = false;
            exoskeleton = false;
            TPButtonPressed = false;
            beekeeper = false;
            terminalFlash = false;
            strongLegs = false;
            runningShoes = false;
            lockSmith = false;
            biggerLungs = false;
            lungLevel = 0;
            backLevel = 0;
            beeLevel = 0;
            runningLevel = 0;
            lightLevel = 0;
            discoLevel = 0;
            legLevel = 0;
            nightVisionLevel = 0;
            flashCooldown = 0f;
            alteredWeight = 1f;
            trapHandler = null;
            flashScript = null;
            if (wipeObjRefs) { UpgradeObjects = new Dictionary<string, GameObject>(); }
            foreach(CustomTerminalNode node in terminalNodes)
            {
                node.Unlocked = false;
                node.CurrentUpgrade = 0;
                if(node.Name == "NV Headset Batteries") { node.Unlocked = true; }
            }
            PlayerControllerB[] players = GameObject.FindObjectsOfType<PlayerControllerB>();
            foreach (PlayerControllerB player in players)
            {
                player.movementSpeed = 4.6f;
                player.sprintTime = 11;
                player.jumpForce = 13;
            }
        }

        internal void GenerateSales(int seed = -1)
        {
            Random.InitState(seed);
            foreach(CustomTerminalNode node in terminalNodes)
            {
                if(node.Name == "Interns") { continue; }
                if(Random.value > UpgradeBus.instance.cfg.SALE_PERC)
                {
                    node.salePerc = Random.Range(0.60f, 0.90f);
                }
                else
                {
                    node.salePerc = 1f;
                }
            }
        }

        internal void AlterStoreItems()
        {
            // nothing works
            Terminal[] terms = GameObject.FindObjectsOfType<Terminal>();
            foreach(Terminal term in terms)
            {
                List<CompatibleNoun> words = new List<CompatibleNoun>();
                foreach(CompatibleNoun word in term.terminalNodes.allKeywords[0].compatibleNouns)
                {
                    if(word.noun.word == "peeper")
                    {
                        if(cfg.PEEPER_ENABLED)words.Add(word);
                        word.result.itemCost = cfg.PEEPER_PRICE;
                    }
                    else if(word.noun.word == "night-vision-goggles")
                    {
                        if(cfg.NIGHT_VISION_ENABLED)words.Add(word);
                        word.result.itemCost = cfg.NIGHT_VISION_PRICE;
                    }
                    else if(word.noun.word == "portable-tele")
                    {
                        if(cfg.WEAK_TELE_ENABLED)words.Add(word);
                        word.result.itemCost = cfg.WEAK_TELE_PRICE;
                    }
                    else if(word.noun.word == "advanced-portable-tele")
                    {
                        if(cfg.ADVANCED_TELE_ENABLED)words.Add(word);
                        word.result.itemCost = cfg.ADVANCED_TELE_PRICE;
                    }
                    else
                    {
                        words.Add(word);
                    }
                    term.terminalNodes.allKeywords[0].compatibleNouns = words.ToArray();
                }
            }
        }

        internal void Reconstruct()
        {
            BuildCustomNodes();
        }
        internal void BuildCustomNodes()
        {
            terminalNodes = new List<CustomTerminalNode>();

            Dictionary<string,string> infoJson = JsonConvert.DeserializeObject<Dictionary<string,string>>(UpgradeAssets.LoadAsset<TextAsset>("Assets/ShipUpgrades/InfoStrings.json").text);

            //Beekeeper
            GameObject beekeeper = UpgradeAssets.LoadAsset<GameObject>("Assets/ShipUpgrades/beekeeper.prefab");
            bool shareStatus = cfg.SHARED_UPGRADES ? true : cfg.BEEKEEPER_INDIVIDUAL;
            IndividualUpgrades = new Dictionary<string, bool>
            {
                { "Beekeeper", shareStatus }
            };
            if (cfg.BEEKEEPER_ENABLED)
            {
                string[] priceString = cfg.BEEKEEPER_UPGRADE_PRICES.Split(',').ToArray();
                int[] prices = new int[priceString.Length];

                for (int i = 0; i < priceString.Length; i++)
                {
                    if (int.TryParse(priceString[i], out int price))
                    {
                        prices[i] = price;
                    }
                    else
                    {
                        Debug.LogWarning($"[LGU] Invalid upgrade price submitted: {prices[i]}");
                        prices[i] = -1;
                    }
                }
                if (prices.Length == 1 && prices[0] == -1) { prices = new int[0]; }

                string infoString = string.Format(infoJson["Beekeeper"], 1, cfg.BEEKEEPER_PRICE, (int)(100 * cfg.BEEKEEPER_DAMAGE_MULTIPLIER));
                for (int i = 0; i < prices.Length; i++)
                {
                    infoString += string.Format(infoJson["Beekeeper"], i + 2, prices[i], (int)(100 * (cfg.BEEKEEPER_DAMAGE_MULTIPLIER - ((i + 1) * cfg.BEEKEEPER_DAMAGE_MULTIPLIER_INCREMENT))));
                }
                CustomTerminalNode beeNode = new CustomTerminalNode("Beekeeper", cfg.BEEKEEPER_PRICE, infoString, beekeeper, prices, prices.Length);
                terminalNodes.Add(beeNode);
            }

            // protein
            GameObject prot = UpgradeAssets.LoadAsset<GameObject>("Assets/ShipUpgrades/ProteinPowder.prefab");
            shareStatus = cfg.SHARED_UPGRADES ? true : cfg.PROTEIN_INDIVIDUAL;
            IndividualUpgrades.Add("Protein Powder", shareStatus);
            if(cfg.PROTEIN_ENABLED)
            {
                string[] priceString = cfg.PROTEIN_UPGRADE_PRICES.Split(',').ToArray();
                int[] prices = new int[priceString.Length];

                for (int i = 0; i < priceString.Length; i++)
                {
                    if (int.TryParse(priceString[i], out int price))
                    {
                        prices[i] = price;
                    }
                    else
                    {
                        Debug.LogWarning($"[LGU] Invalid upgrade price submitted: {prices[i]}");
                        prices[i] = -1;
                    }
                }
                if(prices.Length == 1 && prices[0] == -1) { prices = new int[0]; }

                string infoString = string.Format(infoJson["Protein Powder"],1,cfg.PROTEIN_PRICE,cfg.PROTEIN_UNLOCK_FORCE);
                for(int i = 0; i < prices.Length; i++)
                {
                    infoString += string.Format(infoJson["Protein Powder"], i + 2, prices[i],cfg.PROTEIN_UNLOCK_FORCE + 1 + (cfg.PROTEIN_INCREMENT *i));
                }
                CustomTerminalNode protNode = new CustomTerminalNode("Protein Powder", cfg.PROTEIN_PRICE, infoString, prot, prices, prices.Length);
                terminalNodes.Add(protNode);
            }

            // lungs
            GameObject biggerLungs = UpgradeAssets.LoadAsset<GameObject>("Assets/ShipUpgrades/BiggerLungs.prefab");
            shareStatus = cfg.SHARED_UPGRADES ? true : cfg.BIGGER_LUNGS_INDIVIDUAL;
            IndividualUpgrades.Add("Bigger Lungs", shareStatus);
            if(cfg.BIGGER_LUNGS_ENABLED)
            {
                string[] priceString = cfg.BIGGER_LUNGS_UPGRADE_PRICES.Split(',').ToArray();
                int[] prices = new int[priceString.Length];

                for (int i = 0; i < priceString.Length; i++)
                {
                    if (int.TryParse(priceString[i], out int price))
                    {
                        prices[i] = price;
                    }
                    else
                    {
                        Debug.LogWarning($"[LGU] Invalid upgrade price submitted: {prices[i]}");
                        prices[i] = -1;
                    }
                }
                if(prices.Length == 1 && prices[0] == -1) { prices = new int[0]; }
                string infoString = string.Format(infoJson["Bigger Lungs"],1,cfg.BIGGER_LUNGS_PRICE,cfg.SPRINT_TIME_INCREASE-11f);
                for(int i = 0; i < prices.Length; i++)
                {
                    infoString += string.Format(infoJson["Bigger Lungs"], i + 2, prices[i], (cfg.SPRINT_TIME_INCREASE + ((i+1) * cfg.SPRINT_TIME_INCREMENT))-11f);
                }

                CustomTerminalNode lungNode = new CustomTerminalNode("Bigger Lungs", cfg.BIGGER_LUNGS_PRICE, infoString, biggerLungs, prices, prices.Length);
                terminalNodes.Add(lungNode);
            }

            // running shoes
            GameObject runningShoes = UpgradeAssets.LoadAsset<GameObject>("Assets/ShipUpgrades/runningShoes.prefab");
            shareStatus = cfg.SHARED_UPGRADES ? true : cfg.RUNNING_SHOES_INDIVIDUAL;
            IndividualUpgrades.Add("Running Shoes", shareStatus);
            if(cfg.RUNNING_SHOES_ENABLED)
            {
                string[] priceString = cfg.RUNNING_SHOES_UPGRADE_PRICES.Split(',').ToArray();
                int[] prices = new int[priceString.Length];

                for (int i = 0; i < priceString.Length; i++)
                {
                    if (int.TryParse(priceString[i], out int price))
                    {
                        prices[i] = price;
                    }
                    else
                    {
                        Debug.LogWarning($"[LGU] Invalid upgrade price submitted: {prices[i]}");
                        prices[i] = -1;
                    }
                }
                if(prices.Length == 1 && prices[0] == -1) { prices = new int[0]; }
                string infoString = string.Format(infoJson["Running Shoes"],1,cfg.RUNNING_SHOES_PRICE,cfg.MOVEMENT_SPEED - 4.6f);
                for(int i = 0; i < prices.Length; i++)
                {
                    infoString += string.Format(infoJson["Running Shoes"], i + 2, prices[i], (cfg.MOVEMENT_SPEED + ((i+1) * cfg.MOVEMENT_INCREMENT)) - 4.6f);
                }
                CustomTerminalNode node = new CustomTerminalNode("Running Shoes", cfg.RUNNING_SHOES_PRICE, infoString, runningShoes, prices, prices.Length);
                terminalNodes.Add(node);
            }

            // strong legs
            GameObject strongLegs = UpgradeAssets.LoadAsset<GameObject>("Assets/ShipUpgrades/strongLegs.prefab");
            shareStatus = cfg.SHARED_UPGRADES ? true : cfg.STRONG_LEGS_INDIVIDUAL;
            IndividualUpgrades.Add("Strong Legs", shareStatus);
            if(cfg.STRONG_LEGS_ENABLED)
            {
                string[] priceString = cfg.STRONG_LEGS_UPGRADE_PRICES.Split(',').ToArray();
                int[] prices = new int[priceString.Length];

                for (int i = 0; i < priceString.Length; i++)
                {
                    if (int.TryParse(priceString[i], out int price))
                    {
                        prices[i] = price;
                    }
                    else
                    {
                        Debug.LogWarning($"[LGU] Invalid upgrade price submitted: {prices[i]}");
                        prices[i] = -1;
                    }
                }
                if(prices.Length == 1 && prices[0] == -1) { prices = new int[0]; }
                string infoString = string.Format(infoJson["Strong Legs"],1,cfg.STRONG_LEGS_PRICE,cfg.JUMP_FORCE-13f);
                for(int i = 0; i < prices.Length; i++)
                {
                    infoString += string.Format(infoJson["Strong Legs"], i + 2, prices[i], (cfg.JUMP_FORCE + ((i+1) * cfg.JUMP_FORCE_INCREMENT))-13f);
                }
                CustomTerminalNode node = new CustomTerminalNode("Strong Legs", cfg.STRONG_LEGS_PRICE, infoString, strongLegs, prices, prices.Length);
                terminalNodes.Add(node);
            }

            // destructive codes
            GameObject destructiveCodes = UpgradeAssets.LoadAsset<GameObject>("Assets/ShipUpgrades/destructiveCodes.prefab");
            string desc = "";
            if(cfg.DESTROY_TRAP)
            {
                if(cfg.EXPLODE_TRAP)
                {
                    desc = "Broadcasted codes now explode map hazards.";
                }
                else
                {
                    desc = "Broadcasted codes now destroy map hazards.";
                }
            }
            else { desc = $"Broadcasted codes now disable map hazards for {cfg.DISARM_TIME} seconds."; }
            shareStatus = cfg.SHARED_UPGRADES ? true : cfg.MALWARE_BROADCASTER_INDIVIDUAL;
            IndividualUpgrades.Add("Malware Broadcaster", shareStatus);
            if(cfg.MALWARE_BROADCASTER_ENABLED)
            { 
                CustomTerminalNode node = new CustomTerminalNode("Malware Broadcaster", cfg.MALWARE_BROADCASTER_PRICE, desc, destructiveCodes);
                terminalNodes.Add(node);
            }

            // light footed
            GameObject lightFooted = UpgradeAssets.LoadAsset<GameObject>("Assets/ShipUpgrades/lightFooted.prefab");
            shareStatus = cfg.SHARED_UPGRADES ? true : cfg.LIGHT_FOOTED_INDIVIDUAL;
            IndividualUpgrades.Add("Light Footed", shareStatus);
            if(cfg.LIGHT_FOOTED_ENABLED)
            {
                string[] priceString = cfg.LIGHT_FOOTED_UPGRADE_PRICES.Split(',').ToArray();
                int[] prices = new int[priceString.Length];

                for (int i = 0; i < priceString.Length; i++)
                {
                    if (int.TryParse(priceString[i], out int price))
                    {
                        prices[i] = price;
                    }
                    else
                    {
                        Debug.LogWarning($"[LGU] Invalid upgrade price submitted: {prices[i]}");
                        prices[i] = -1;
                    }
                }
                if(prices.Length == 1 && prices[0] == -1) { prices = new int[0]; }
                string infoString = string.Format(infoJson["Light Footed"],1,cfg.LIGHT_FOOTED_PRICE,cfg.NOISE_REDUCTION);
                for(int i = 0; i < prices.Length; i++)
                {
                    infoString += string.Format(infoJson["Light Footed"], i + 2, prices[i], cfg.NOISE_REDUCTION + ((i+1) * cfg.NOISE_REDUCTION_INCREMENT));
                }
                CustomTerminalNode node = new CustomTerminalNode("Light Footed", cfg.LIGHT_FOOTED_PRICE, infoString, lightFooted, prices, prices.Length);
                terminalNodes.Add(node);
            }


            // night vision
            GameObject nightVision = UpgradeAssets.LoadAsset<GameObject>("Assets/ShipUpgrades/nightVision.prefab");
            shareStatus = cfg.SHARED_UPGRADES ? true : cfg.NIGHT_VISION_INDIVIDUAL;
            IndividualUpgrades.Add("NV Headset Batteries", shareStatus);
            if(cfg.NIGHT_VISION_ENABLED) 
            { 
                string[] priceString = cfg.NIGHT_VISION_UPGRADE_PRICES.Split(',').ToArray();
                int[] prices = new int[priceString.Length];

                for (int i = 0; i < priceString.Length; i++)
                {
                    if (int.TryParse(priceString[i], out int price))
                    {
                        prices[i] = price;
                    }
                    else
                    {
                        Debug.LogWarning($"[LGU] Invalid upgrade price submitted: {prices[i]}");
                        prices[i] = -1;
                    }
                }
                if(prices.Length == 1 && prices[0] == -1) { prices = new int[0]; }
                string infoString = "";
                for(int i = 0; i < prices.Length; i++)
                {
                    float regenAdjustment = Mathf.Pow(1 + cfg.NIGHT_VIS_REGEN_INCREASE_PERCENT / 100f, i) * 0.01f;
                    float drainAdjustment = Mathf.Pow(1 - cfg.NIGHT_VIS_DRAIN_DECREASE_PERCENT / 100f, i) * 0.01f;

                    infoString += string.Format(infoJson["NV Headset Batteries"], i + 1, prices[i], cfg.NIGHT_VIS_DRAIN_SPEED - drainAdjustment, cfg.NIGHT_VIS_REGEN_SPEED + regenAdjustment);
                }
                CustomTerminalNode node = new CustomTerminalNode(
                    "NV Headset Batteries",
                    cfg.NIGHT_VISION_PRICE,
                    infoString,
                    nightVision,
                    prices,
                    prices.Length
                    );
                node.Unlocked = true;
                terminalNodes.Add(node);
            }


            // discombob
            GameObject flash = UpgradeAssets.LoadAsset<GameObject>("Assets/ShipUpgrades/terminalFlash.prefab");
            AudioClip flashSFX = UpgradeAssets.LoadAsset<AudioClip>("Assets/ShipUpgrades/flashbangsfx.ogg");
            UpgradeBus.instance.flashNoise = flashSFX;
            shareStatus = cfg.SHARED_UPGRADES ? true : cfg.DISCOMBOBULATOR_INDIVIDUAL;
            IndividualUpgrades.Add("Discombobulator", shareStatus);
            if(cfg.DISCOMBOBULATOR_ENABLED)
            {
                string[] priceString = cfg.DISCO_UPGRADE_PRICES.Split(',').ToArray();
                int[] prices = new int[priceString.Length];

                for (int i = 0; i < priceString.Length; i++)
                {
                    if (int.TryParse(priceString[i], out int price))
                    {
                        prices[i] = price;
                    }
                    else
                    {
                        Debug.LogWarning($"[LGU] Invalid upgrade price submitted: {prices[i]}");
                        prices[i] = -1;
                    }
                }
                if(prices.Length == 1 && prices[0] == -1) { prices = new int[0]; }
                string infoString = string.Format(infoJson["Discombobulator"],1,cfg.DISCOMBOBULATOR_PRICE,cfg.DISCOMBOBULATOR_STUN_DURATION);
                for(int i = 0; i < prices.Length; i++)
                {
                    infoString += string.Format(infoJson["Discombobulator"], i + 2, prices[i], cfg.DISCOMBOBULATOR_STUN_DURATION + ((i+1) * cfg.DISCOMBOBULATOR_INCREMENT));
                }
                CustomTerminalNode node = new CustomTerminalNode("Discombobulator", cfg.DISCOMBOBULATOR_PRICE, infoString, flash, prices, prices.Length);
                terminalNodes.Add(node);
            }

            //stronger scanner
            GameObject strongScan = UpgradeAssets.LoadAsset<GameObject>("Assets/ShipUpgrades/strongScanner.prefab");
            shareStatus = cfg.SHARED_UPGRADES ? true : cfg.BETTER_SCANNER_INDIVIDUAL;
            IndividualUpgrades.Add("Better Scanner", shareStatus);
            if(cfg.BETTER_SCANNER_ENABLED)
            {
                string LOS = cfg.REQUIRE_LINE_OF_SIGHT ? "Does not remove" : "Removes";
                string info = $"Increase distance nodes can be scanned by {cfg.NODE_DISTANCE_INCREASE} units.  \nIncrease distance Ship and Entrance can be scanned by {cfg.SHIP_AND_ENTRANCE_DISTANCE_INCREASE} units.\n{LOS} LOS requirement\n";
                CustomTerminalNode node = new CustomTerminalNode("Better Scanner", cfg.BETTER_SCANNER_PRICE, info, strongScan);
                terminalNodes.Add(node);
            }

            // walkie
            GameObject walkie = UpgradeAssets.LoadAsset<GameObject>("Assets/ShipUpgrades/walkieUpgrade.prefab");
            IndividualUpgrades.Add("Walkie GPS", true);
            if(cfg.WALKIE_ENABLED)
            {
                CustomTerminalNode node = new CustomTerminalNode("Walkie GPS", cfg.WALKIE_PRICE, "Displays your location and time when holding a walkie talkie.\nEspecially useful for fog.", walkie);
                terminalNodes.Add(node);
            }

            // back muscles
            GameObject exoskel = UpgradeAssets.LoadAsset<GameObject>("Assets/ShipUpgrades/exoskeleton.prefab");
            shareStatus = cfg.SHARED_UPGRADES ? true : cfg.BACK_MUSCLES_INDIVIDUAL;
            IndividualUpgrades.Add("Back Muscles", shareStatus);
            if(cfg.BACK_MUSCLES_ENABLED)
            {
                string[] priceString = cfg.BACK_MUSCLES_UPGRADE_PRICES.Split(',').ToArray();
                int[] prices = new int[priceString.Length];

                for (int i = 0; i < priceString.Length; i++)
                {
                    if (int.TryParse(priceString[i], out int price))
                    {
                        prices[i] = price;
                    }
                    else
                    {
                        Debug.LogWarning($"[LGU] Invalid upgrade price submitted: {prices[i]}");
                        prices[i] = -1;
                    }
                }
                if(prices.Length == 1 && prices[0] == -1) { prices = new int[0]; }
                string infoString = string.Format(infoJson["Back Muscles"],1,cfg.BACK_MUSCLES_PRICE,Mathf.RoundToInt(cfg.CARRY_WEIGHT_REDUCTION*100));
                for(int i = 0; i < prices.Length; i++)
                {
                    infoString += string.Format(infoJson["Back Muscles"], i + 2, prices[i], Mathf.RoundToInt((cfg.CARRY_WEIGHT_REDUCTION - ((i+1) * cfg.CARRY_WEIGHT_INCREMENT)) * 100));
                }
                CustomTerminalNode node = new CustomTerminalNode("Back Muscles", cfg.BACK_MUSCLES_PRICE, infoString, exoskel, prices, prices.Length);
                terminalNodes.Add(node);
            }

            // interns
            GameObject intern = UpgradeAssets.LoadAsset<GameObject>("Assets/ShipUpgrades/Pager.prefab");
            shareStatus = cfg.SHARED_UPGRADES ? true : cfg.INTERN_INDIVIDUAL;
            IndividualUpgrades.Add("Interns", shareStatus);
            if (cfg.INTERN_ENABLED)
            {
                CustomTerminalNode node = new CustomTerminalNode("Interns", cfg.INTERN_PRICE, string.Format(infoJson["Interns"], cfg.INTERN_PRICE), intern);
                terminalNodes.Add(node);
            }

            //lockSmith
            GameObject lockSmith = UpgradeAssets.LoadAsset<GameObject>("Assets/ShipUpgrades/LockSmith.prefab");
            shareStatus = cfg.SHARED_UPGRADES ? true : cfg.LOCKSMITH_INDIVIDUAL;
            IndividualUpgrades.Add("Locksmith", shareStatus);
            if (cfg.LOCKSMITH_ENABLED)
            {
                CustomTerminalNode node = new CustomTerminalNode("Locksmith", cfg.LOCKSMITH_PRICE,"Allows you to pick door locks by completing a minigame.", lockSmith);
                terminalNodes.Add(node);
            }


        }
    }
}